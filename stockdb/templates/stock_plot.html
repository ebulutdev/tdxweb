<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>MIATK.IS Son 1 Aylık Kapanış Fiyatları</title>
    <style>
        body { background: #181818; color: #fff; text-align: center; }
        .container { margin: 40px auto; width: 1100px; background: #222; color: #fff; padding: 40px 40px 30px 40px; border-radius: 20px; box-shadow: 0 4px 24px #111; }
        button { padding: 12px 36px; font-size: 20px; border-radius: 10px; border: none; background: #4caf50; color: #fff; cursor: pointer; margin-top: 30px; }
        #analysis { margin-top: 30px; background: #333; color: #fff; padding: 24px; border-radius: 12px; min-height: 60px; font-size: 18px; }
        h2 { font-size: 2rem; font-weight: bold; margin-bottom: 30px; color: #fff; }
        h3 { margin-top: 40px; color: #fff; }
        ul { font-size: 1.1rem; color: #fff; }
    </style>
</head>
<body>
    <div class="container">
        <h2>MIATK.IS Son 1 Aylık Kapanış Fiyatları</h2>
        {{ plotly_html|safe }}
        <br>
        <button id="analyzeBtn" onclick="getAnalysis()">Analiz Al (Gemini 1.5 Flash)</button>
        <div id="analysis">Analiz için butona tıklayın.</div>
        <div style="margin-top:40px; text-align:left;">
            <h3 style="color:#fff;">MIATK Son 1 Haftadaki Haberler</h3>
            <ul style="background:#333; padding:20px; border-radius:10px;">
                {% for item in news %}
                    <li style="margin-bottom:18px;">
                        <a href="{{ item.link }}" target="_blank" style="color:#4cafef; font-weight:bold;">{{ item.title }}</a><br>
                        <span style="color:#aaa; font-size:13px;">{{ item.published }}{% if item.source %} | {{ item.source }}{% endif %}</span><br>
                        <span style="color:#ccc; font-size:14px;">{{ item.summary|safe }}</span>
                    </li>
                {% empty %}
                    <li style="color:#aaa;">Hiç haber bulunamadı.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <script>
        var closes = JSON.parse('{{ closes|escapejs }}');
        var dates = JSON.parse('{{ dates|escapejs }}');
        function getAnalysis() {
            var btn = document.getElementById('analyzeBtn');
            btn.disabled = true;
            document.getElementById('analysis').innerText = 'Analiz getiriliyor...';
            fetch('/get-analysis/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    closes: closes,
                    dates: dates
                })
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById('analysis').innerText = data.analysis || data.error;
                btn.disabled = false;
            })
            .catch(() => {
                document.getElementById('analysis').innerText = 'Bir hata oluştu.';
                btn.disabled = false;
            });
        }
    </script>
</body>
</html> 